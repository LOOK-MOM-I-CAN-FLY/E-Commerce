# Digital Marketplace

## Описание проекта

Digital Marketplace (June) - это веб-платформа электронной коммерции, разработанная для продажи и покупки цифровых товаров. Проект написан на Go с использованием фреймворка Gin и позволяет пользователям регистрироваться, загружать цифровые продукты для продажи, а также просматривать и покупать товары других пользователей.

## ***Основной функционал***

- **Аутентификация пользователей**:
  - Классическая регистрация и вход по логину/паролю
  - OAuth аутентификация через GitHub

- **Управление цифровыми товарами**:
  - Загрузка новых товаров (файл + изображение)
  - Просмотр загруженных товаров
  - Безопасное скачивание купленных товаров

- **Система покупок**:
  - Корзина для добавления нескольких товаров
  - Оформление заказа

- **Дополнительные возможности**:
  - Интеграция с системой уведомлений по email (через SMTP)
  - Безопасное хранение и доступ к файлам
  - Отдельный административный интерфейс

## ***Технический стек***

- **Backend**: Go (Golang) с фреймворком Gin
- **База данных**: PostgreSQL
- **Хранение данных**: Локальная файловая система
- **Веб-сервер**: Nginx (для раздачи статики и проксирования запросов)
- **Контейнеризация**: Docker и Docker Compose
- **Аутентификация**: JWT, OAuth (GitHub)
- **Почтовый сервис**: Поддержка SMTP сервер Yandex
- **CI/CD**: GitHub Actions

## ***Инструкция по запуску***

### Метод 1: Docker (рекомендуется)

#### Предварительные требования:
- Docker
- Docker Compose

#### Шаги по запуску:

1. **Настроить переменные окружения**:
   ```bash
   cp example.env .env
   ```
   Отредактируйте файл `.env` и настройте:
   - SMTP параметры для отправки писем
   - GitHub OAuth данные (если планируется использование)
   - Другие необходимые параметры

2. **Запустить все контейнеры**:
   ```bash
   docker compose up -d
   ```

3. **Доступ к приложению**:
   - Веб-интерфейс: http://localhost

#### Управление контейнерами:

- **Просмотр логов**:
  ```bash
  docker compose logs -f
  ```

- **Остановка без удаления данных**:
  ```bash
  docker compose down
  ```

- **Полная остановка с удалением всех данных**:
  ```bash
  docker compose down -v
  ```

### Метод 2: Локальный запуск

#### Предварительные требования:
- Go версии 1.23.0 или выше
- PostgreSQL
- Веб-сервер (опционально)

#### Шаги по запуску:

1. **Настроить переменные окружения**:
   ```bash
   cp example.env .env
   ```
   Отредактируйте файл `.env`, указав настройки для:
   - Локальной базы данных PostgreSQL
   - SMTP сервера
   - GitHub OAuth (если необходимо)
   
2. **Запустить миграцию базы данных**:
   ```bash
   go run cmd/migration/main.go
   ```

3. **Запустить приложение**:
   ```bash
   go run cmd/main.go
   ```

4. **Доступ к приложению**:
   - Веб-интерфейс будет доступен по адресу: http://localhost:8080

## ***Деплой и CI/CD***

Проект настроен для автоматического деплоя через GitHub Actions. Полные инструкции по деплою, включая настройку:
- Docker и контейнеризации
- CI/CD с GitHub Actions
- SMTP для отправки писем
- GitHub OAuth
- Сохранение данных БД и файлов пользователей

Находятся в файле [DEPLOYMENT.md](DEPLOYMENT.md).

## Проверка работоспособности

Приложение предоставляет эндпоинт `/health` для проверки работоспособности.

Проверка:
```bash
curl -f http://localhost/health
```

Должен вернуть `OK` со статусом 200.

## Основные маршруты

- `/` - Главная страница с списком товаров
- `/register` - Страница регистрации
- `/login` - Страница входа
- `/auth/github` - Вход через GitHub
- `/profile` - Личный профиль пользователя
- `/upload` - Загрузка нового товара
- `/cart` - Корзина покупок
- `/checkout` - Оформление заказа
- `/products` - Просмотр всех доступных товаров
- `/health` - Проверка работоспособности (для мониторинга)

## ***Структура хранения данных***

- **База данных PostgreSQL**: Хранение информации о пользователях, товарах, заказах
- **Директория uploads/**: Хранение файлов товаров и изображений
- **Docker Volumes**: Персистентное хранение данных при использовании Docker
  - `marketplace_pgdata`: Данные PostgreSQL
  - `marketplace_uploads`: Загруженные файлы пользователей

## ***Рекомендации по разработке***

1. Для добавления новых функций следуйте существующей структуре проекта
2. Все статические файлы размещайте в директории `web/static/`
3. Шаблоны размещайте в директории `web/templates/`

## ***Дополнительная информация***

- Для существующих пользователей поле username может быть пустым, пока они не обновят свой профиль
- При аутентификации через GitHub, имя пользователя берется из профиля GitHub
- Все загруженные файлы хранятся в директории `uploads/` с разделением по типу контента 
