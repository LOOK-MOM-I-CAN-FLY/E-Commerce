# Рекомендации по безопасности и обслуживанию проекта

## Секреты и переменные окружения

1. **Все секреты должны храниться только в .env файле**:
   - Пароли баз данных
   - Ключи доступа к API
   - Ключи шифрования
   - OAuth ключи и секреты

2. **Никогда не коммитьте .env файлы в репозиторий**:
   - Используйте `.gitignore` для исключения `.env*` файлов
   - Вместо этого предоставьте файл `example.env` с примером, но без реальных секретов

3. **Обеспечьте безопасную передачу .env файлов**:
   - Используйте зашифрованные каналы для передачи секретов
   - Рассмотрите возможность использования инструментов управления секретами (HashiCorp Vault, AWS Secrets Manager)

## Регулярное обновление

1. **Обновляйте образы Docker**:
   ```bash
   # Выполняйте регулярно
   docker-compose pull
   docker-compose up -d
   ```

2. **Обновляйте базовые образы**:
   - Периодически обновляйте версии golang, nginx и postgres в Dockerfile и docker-compose.yml
   - Проверяйте совместимость перед обновлением в продакшен

3. **Обновление зависимостей Go**:
   ```bash
   # Обновление всех зависимостей и проверка совместимости
   go get -u ./...
   go mod tidy
   ```

## Мониторинг состояния приложения

1. **Базовый мониторинг с помощью Docker**:
   ```bash
   # Просмотр логов
   docker-compose logs -f app

   # Мониторинг ресурсов
   docker stats
   ```

2. **Настройте внешний мониторинг**:
   - Рассмотрите интеграцию с Prometheus и Grafana для мониторинга
   - Добавьте HTTP эндпоинт `/health` для проверки работоспособности приложения:
     ```go
     // В файле main.go добавьте:
     router.GET("/health", func(c *gin.Context) {
         c.JSON(200, gin.H{"status": "ok"})
     })
     ```

3. **Настройте оповещения**:
   - Настройте оповещения о проблемах в работе приложения
   - Используйте сервисы вроде Telegram Bot, Email или SMS для уведомлений

## Резервное копирование

1. **Регулярное резервное копирование базы данных**:
   ```bash
   # Автоматизируйте этот процесс с помощью cron
   docker-compose exec db pg_dump -U postgres marketplace > backup_$(date +%Y%m%d).sql
   ```

2. **Хранение резервных копий**:
   - Храните резервные копии в безопасном месте
   - Рассмотрите возможность использования облачного хранилища (S3, Google Cloud Storage)

## Безопасность Nginx

1. **Проверка конфигурации Nginx**:
   ```bash
   # Проверяйте конфигурацию перед перезапуском
   docker-compose exec nginx nginx -t
   ```

2. **SSL/TLS сертификаты**:
   - Настройте автоматическое обновление сертификатов с помощью certbot:
   ```bash
   # Пример автоматизации с certbot в контейнере
   docker run -it --rm \
     -v "$(pwd)/nginx/ssl:/etc/letsencrypt" \
     -v "$(pwd)/nginx/ssl:/var/lib/letsencrypt" \
     certbot/certbot certonly --webroot \
     --webroot-path=/var/lib/letsencrypt \
     -d yourdomain.com -d www.yourdomain.com
   ```

3. **Регулярные обновления Nginx**:
   ```bash
   # Обновление образа Nginx
   docker-compose pull nginx
   docker-compose up -d nginx
   ```

## Дополнительные рекомендации

1. **Ограничьте доступ к VPS**:
   - Используйте SSH-ключи вместо паролей
   - Настройте брандмауэр (ufw или iptables)
   - Ограничьте доступ по IP, если это возможно

2. **Регулярное обновление ОС на VPS**:
   ```bash
   # Для Ubuntu/Debian
   apt update && apt upgrade -y
   
   # Для CentOS/RHEL
   yum update -y
   ```

3. **Мониторинг дискового пространства**:
   ```bash
   # Регулярно проверяйте свободное место на диске
   df -h
   
   # Очистка неиспользуемых Docker-ресурсов
   docker system prune -af --volumes
   ``` 